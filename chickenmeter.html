<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>ChickenMeter</title>
<style>
  body { margin:0; background:transparent; overflow:hidden; }
  #container { position:relative; width:400px; height:600px; margin:auto; }
  #fill {
    position:absolute; bottom:0; left:0; width:100%; height:0%;
    background:url("fillmeter_fill.png") no-repeat bottom;
    background-size:contain;
    z-index:1;
    transition:height 1s ease; /* smooth fill animation */
  }
  #background {
    position:absolute; top:0; left:0; width:100%; height:100%;
    background:url("fillmeter_background.png") no-repeat center;
    background-size:contain;
    z-index:2;
  }
</style>
</head>
<body>
  <div id="container">
    <div id="fill"></div>
    <div id="background"></div>
    <audio id="cluck" src="cluck.mp3" preload="auto"></audio>
  </div>

  <script>
    const GOAL = 500; // coins required for full bar
    let currentCoins = 0;

    function updateFill() {
      let percent = Math.min(100, (currentCoins / GOAL) * 100);
      document.getElementById("fill").style.height = percent + "%";
    }

    function resetMeter() {
      currentCoins = 0;
      updateFill();
    }

    // Keybind for reset (Y key)
    document.addEventListener("keydown", (event) => {
      if (event.key.toLowerCase() === "y") {
        resetMeter();
      }
    });

    // Connect to TikFinity Event API
    const ws = new WebSocket("ws://localhost:21213/events");

    ws.onmessage = (event) => {
      const data = JSON.parse(event.data);
      if (data.type === "gift") {
        currentCoins += data.coins;  // add giftâ€™s coin value
        updateFill();

        // Play cluck sound
        const cluck = document.getElementById("cluck");
        cluck.currentTime = 0; // restart sound if spammed
        cluck.play();
      }
    };
  </script>
</body>
</html>



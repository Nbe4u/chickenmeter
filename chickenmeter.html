
<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>ChickenMeter Masked</title>
<style>
  body { margin:0; background:transparent; overflow:hidden; }
  #container {
    width:400px;
    height:600px;
    margin:auto;
  }
  svg {
    width:100%;
    height:100%;
  }
  #fill {
    fill: orange;
    transition: y 1s ease, height 1s ease;
  }
  #outline {
    fill:none;
    stroke:black;
    stroke-width:6;
  }
</style>
</head>
<body>
  <div id="container">
    <svg viewBox="0 0 400 600">
      <!-- Orange fill clipped to egg -->
      <clipPath id="eggClip">
        <ellipse cx="200" cy="300" rx="150" ry="250"/>
      </clipPath>
      <rect id="fill" x="50" y="600" width="300" height="0" clip-path="url(#eggClip)"/>
      <!-- Egg outline -->
      <ellipse id="outline" cx="200" cy="300" rx="150" ry="250"/>
    </svg>
    <audio id="cluck" src="yipeeeeeeeee.mp3" preload="auto"></audio>
  </div>

  <script>
    const GOAL = 500;
    let currentCoins = 0;

    function updateFill() {
      let percent = Math.min(100, (currentCoins / GOAL) * 100);
      const fill = document.getElementById("fill");
      let height = (percent/100) * 500;  // egg height to fill
      fill.setAttribute("y", 600 - height);
      fill.setAttribute("height", height);
    }

    function playSound() {
      const cluck = document.getElementById("cluck");
      cluck.currentTime = 0;
      cluck.play().catch(err => console.log("Sound blocked:", err));
    }

    document.addEventListener("keydown", (event) => {
      if (event.key.toLowerCase() === "t") {
        currentCoins += 50; // test fill
        updateFill();
        playSound();
      }
      if (event.key.toLowerCase() === "y") {
        currentCoins = 0;
        updateFill();
      }
    });

    // WebSocket for TikFinity
    const ws = new WebSocket("ws://localhost:21213/events");
    ws.onmessage = (event) => {
      const data = JSON.parse(event.data);
      if (data.Type?.toLowerCase() === "gift" || data.type?.toLowerCase() === "gift") {
        const coins = data.Coins || data.coins || 0;
        currentCoins += coins;
        updateFill();
        playSound();
      }
    };
  </script>
</body>
</html>



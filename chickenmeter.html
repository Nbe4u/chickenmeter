

<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>ChickenMeter – Debug Mode</title>
<style>
  body { margin:0; background:transparent; overflow:hidden; }
  #container { width:400px; height:600px; margin:auto; }
  svg { width:100%; height:100%; }
  #liquid { fill: orange; transition: y 1s ease, height 1s ease; }
  #eggOutline { fill:none; stroke:black; stroke-width:6; }
  .tick { stroke:red; stroke-width:3; }
  .label { fill:red; font-size:20px; font-family:Arial, sans-serif; }
  .goal { fill:red; font-size:28px; font-weight:bold; font-family:Arial, sans-serif; text-anchor:middle; }
</style>
</head>
<body>
  <div id="container">
    <svg viewBox="0 0 400 600">

      <!-- Egg clip path -->
      <defs>
        <clipPath id="eggClip">
          <ellipse cx="200" cy="300" rx="150" ry="250"/>
        </clipPath>
      </defs>

      <!-- Chicken graphic inside egg -->
      <image href="chicken.png" 
             x="90" y="200" width="220" height="220" clip-path="url(#eggClip)" />

      <!-- Orange liquid -->
      <rect id="liquid" x="50" y="600" width="300" height="0" clip-path="url(#eggClip)"/>

      <!-- Egg outline -->
      <ellipse id="eggOutline" cx="200" cy="300" rx="150" ry="250"/>

      <!-- Gift goal label -->
      <text class="goal" x="200" y="30">Gift Goal: 500</text>

      <!-- Tick marks and labels -->
      <line class="tick" x1="330" y1="50" x2="360" y2="50"/>
      <text class="label" x="365" y="55">500</text>

      <line class="tick" x1="330" y1="170" x2="360" y2="170"/>
      <text class="label" x="365" y="175">400</text>

      <line class="tick" x1="330" y1="300" x2="360" y2="300"/>
      <text class="label" x="365" y="305">300</text>

      <line class="tick" x1="330" y1="430" x2="360" y2="430"/>
      <text class="label" x="365" y="435">200</text>

      <line class="tick" x1="330" y1="550" x2="360" y2="550"/>
      <text class="label" x="365" y="555">100</text>

      <line class="tick" x1="330" y1="580" x2="360" y2="580"/>
      <text class="label" x="365" y="585">0</text>
    </svg>

    <audio id="cluck" src="yipeeeeeeeee.mp3" preload="auto"></audio>
  </div>

  <script>
    const GOAL = 500;
    let currentCoins = 0;

    function updateFill() {
      let percent = Math.min(100, (currentCoins / GOAL) * 100);
      let maxHeight = 600;
      let fillHeight = (percent/100) * maxHeight;
      let y = 600 - fillHeight;

      const liquid = document.getElementById("liquid");
      liquid.setAttribute("y", y);
      liquid.setAttribute("height", fillHeight);
    }

    function playSound() {
      const cluck = document.getElementById("cluck");
      cluck.currentTime = 0;
      cluck.play().catch(err => console.log("Sound blocked:", err));
    }

    document.addEventListener("keydown", (event) => {
      if (event.key.toLowerCase() === "t") {
        currentCoins += 50; // test
        updateFill();
        playSound();
      }
      if (event.key.toLowerCase() === "y") {
        currentCoins = 0;
        updateFill();
      }
    });

    // WebSocket for TikFinity
    const ws = new WebSocket("ws://localhost:21213/events");
    ws.onopen = () => console.log("✅ Connected to TikFinity WebSocket");
    ws.onerror = (err) => console.error("❌ WebSocket error:", err);

    ws.onmessage = (event) => {
      const data = JSON.parse(event.data);
      console.log("📩 Gift Event Data:", data);   // 👈 log raw event

      const type = (data.Type || data.type || "").toLowerCase();

      if (type === "gift") {
        const coins =
          data.Coins || data.coins ||
          data.Amount || data.amount ||
          data.DiamondCount || data.diamondCount ||
          1; // fallback

        console.log("💰 Coins detected:", coins); // 👈 log parsed coins

        currentCoins += coins;
        updateFill();
        playSound();
      }
    };
  </script>
</body>
</html>


